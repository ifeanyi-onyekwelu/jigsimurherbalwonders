{% extends 'base.html' %}

{% block title %}Order #{{ order.order_number }} - JigsimurHerbal{% endblock %}

{% block content %}
<div class="container my-5">
  <div class="row">
    <div class="col-lg-8">
      <!-- Order Header -->
      <div class="card mb-4">
        <div class="card-header bg-success text-white">
          <div class="d-flex justify-content-between align-items-center">
            <h4 class="mb-0"><i class="fas fa-receipt"></i> Order #{{ order.order_number }}</h4>
            <span class="badge
              {% if order.status == 'delivered' %}bg-light text-success
              {% elif order.status == 'shipped' %}bg-info
              {% elif order.status == 'processing' %}bg-warning text-dark
              {% elif order.status == 'cancelled' %}bg-danger
              {% else %}bg-secondary
              {% endif %}">
              {{ order.get_status_display }}
            </span>
          </div>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-sm-6">
              <strong>Order Date:</strong><br>
              {{ order.created_at|date:"F d, Y - g:i A" }}
            </div>
            <div class="col-sm-6">
              <strong>Payment Status:</strong><br>
              <span class="badge
                {% if order.payment_status == 'paid' %}bg-success
                {% elif order.payment_status == 'failed' %}bg-danger
                {% elif order.payment_status == 'refunded' %}bg-warning text-dark
                {% else %}bg-secondary
                {% endif %}">
                {{ order.get_payment_status_display }}
              </span>
            </div>
          </div>

          {% if order.notes %}
          <div class="row mt-3">
            <div class="col-12">
              <strong>Order Notes:</strong><br>
              <p class="text-muted">{{ order.notes }}</p>
            </div>
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Order Items -->
      <div class="card mb-4">
        <div class="card-header bg-light">
          <h5 class="mb-0"><i class="fas fa-shopping-bag"></i> Items in this Order</h5>
        </div>
        <div class="card-body">
          {% for item in order.items.all %}
          <div class="row align-items-center py-3 {% if not forloop.last %}border-bottom{% endif %}">
            <div class="col-md-2">
              {% if item.product.image %}
              <img src="{{ item.product.image.url }}" alt="{{ item.product_name }}" class="img-fluid rounded"
                style="width: 60px; height: 60px; object-fit: cover;">
              {% else %}
              <div class="bg-light rounded d-flex align-items-center justify-content-center"
                style="width: 60px; height: 60px;">
                <i class="fas fa-leaf text-success"></i>
              </div>
              {% endif %}
            </div>
            <div class="col-md-6">
              <h6 class="mb-1">{{ item.product_name }}</h6>
              <small class="text-muted">Unit Price: ₦{{ item.product_price }}</small>
            </div>
            <div class="col-md-2 text-center">
              <span class="badge bg-light text-dark">Qty: {{ item.quantity }}</span>
            </div>
            <div class="col-md-2 text-end">
              <strong>₦{{ item.total_price }}</strong>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>

      <!-- Order Tracking -->
      {% if order.tracking.all %}
      <div class="card mb-4">
        <div class="card-header bg-light">
          <h5 class="mb-0"><i class="fas fa-route"></i> Order Tracking</h5>
        </div>
        <div class="card-body">
          {% for tracking in order.tracking.all %}
          <div class="d-flex mb-3">
            <div class="flex-shrink-0">
              <div class="bg-success text-white rounded-circle d-flex align-items-center justify-content-center"
                style="width: 40px; height: 40px;">
                <i class="fas fa-check fa-sm"></i>
              </div>
            </div>
            <div class="flex-grow-1 ms-3">
              <h6 class="mb-1">{{ tracking.get_status_display }}</h6>
              <p class="text-muted small mb-1">{{ tracking.description }}</p>
              <small class="text-muted">{{ tracking.created_at|date:"M d, Y - g:i A" }}</small>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}
    </div>

    <!-- Order Summary Sidebar -->
    <div class="col-lg-4">
      <!-- Order Summary -->
      <div class="card mb-4">
        <div class="card-header bg-light">
          <h5 class="mb-0"><i class="fas fa-calculator"></i> Order Summary</h5>
        </div>
        <div class="card-body">
          <div class="d-flex justify-content-between py-2">
            <span>Subtotal:</span>
            <span>₦{{ order.subtotal }}</span>
          </div>
          <div class="d-flex justify-content-between py-2">
            <span>Shipping:</span>
            <span>₦{{ order.shipping_cost }}</span>
          </div>
          <div class="d-flex justify-content-between py-2">
            <span>Tax:</span>
            <span>₦{{ order.tax_amount }}</span>
          </div>
          <hr>
          <div class="d-flex justify-content-between">
            <strong>Total:</strong>
            <strong class="text-success">₦{{ order.total_amount }}</strong>
          </div>
        </div>
      </div>

      <!-- Billing Address -->
      <div class="card mb-4">
        <div class="card-header bg-light">
          <h6 class="mb-0"><i class="fas fa-credit-card"></i> Billing Address</h6>
        </div>
        <div class="card-body">
          <address class="small">
            {{ order.billing_first_name }} {{ order.billing_last_name }}<br>
            {% if order.billing_company %}{{ order.billing_company }}<br>{% endif %}
            {{ order.billing_address_line_1 }}<br>
            {% if order.billing_address_line_2 %}{{ order.billing_address_line_2 }}<br>{% endif %}
            {{ order.billing_city }}, {{ order.billing_state }} {{ order.billing_postal_code }}<br>
            {{ order.billing_country }}
          </address>
        </div>
      </div>

      <!-- Shipping Address -->
      <div class="card mb-4">
        <div class="card-header bg-light">
          <h6 class="mb-0"><i class="fas fa-truck"></i> Shipping Address</h6>
        </div>
        <div class="card-body">
          <address class="small">
            {{ order.shipping_first_name }} {{ order.shipping_last_name }}<br>
            {% if order.shipping_company %}{{ order.shipping_company }}<br>{% endif %}
            {{ order.shipping_address_line_1 }}<br>
            {% if order.shipping_address_line_2 %}{{ order.shipping_address_line_2 }}<br>{% endif %}
            {{ order.shipping_city }}, {{ order.shipping_state }} {{ order.shipping_postal_code }}<br>
            {{ order.shipping_country }}
          </address>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="d-grid gap-2">
        <a href="{% url 'users:order_history' %}" class="btn btn-outline-success">
          <i class="fas fa-arrow-left"></i> Back to Order History
        </a>
        {% if order.status == 'delivered' %}
        <a href="#" class="btn btn-success">
          <i class="fas fa-star"></i> Leave a Review
        </a>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
