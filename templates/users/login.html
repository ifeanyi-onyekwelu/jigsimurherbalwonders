{% extends 'base.html' %}

{% block title %}Login - JigsimurHerbal{% endblock %}

{% block content %}
<div class="container py-5" style="min-height: 100vh;">
  <div class="row justify-content-center">
    <div class="col-12 col-sm-10 col-md-8 col-lg-6 col-xl-5">
      <div class="card shadow border-0 rounded-3">
        <div class="card-body p-5">
          <!-- Header -->
          <div class="text-center mb-5">
            <div class="mb-3">
              <i class="fas fa-leaf fa-2x text-success"></i>
            </div>
            <h4 class="text-success fw-bold mb-2">Welcome Back</h4>
            <p class="text-muted small">Sign in to your JigsimurHerbal account</p>
          </div>

          <!-- Login Form -->
          <form method="post" novalidate>
            {% csrf_token %}

            <!-- Username/Email Field -->
            <div class="mb-4">
              <label for="{{ form.username.id_for_label }}" class="form-label small fw-medium mb-2">
                {{ form.username.label }}
              </label>
              {{ form.username }}
              {% if form.username.help_text %}
              <div class="form-text small">{{ form.username.help_text }}</div>
              {% endif %}
              {% if form.username.errors %}
              <div class="text-danger mt-1">
                {% for error in form.username.errors %}
                <small>{{ error }}</small>
                {% endfor %}
              </div>
              {% endif %}
            </div>

            <!-- Password Field -->
            <div class="mb-4">
              <label for="{{ form.password.id_for_label }}" class="form-label small fw-medium mb-2">
                {{ form.password.label }}
              </label>
              <div class="position-relative">
                {{ form.password }}
                <button type="button" class="btn btn-link position-absolute end-0 top-50 translate-middle-y pe-3"
                  onclick="togglePassword()" style="border: none; background: none;">
                  <i class="fas fa-eye small" id="togglePasswordIcon"></i>
                </button>
              </div>
              {% if form.password.errors %}
              <div class="text-danger mt-1">
                {% for error in form.password.errors %}
                <small>{{ error }}</small>
                {% endfor %}
              </div>
              {% endif %}
            </div>

            <!-- Remember Me & Forgot Password -->
            <div class="row align-items-center mb-5">
              <div class="col-7">
                <div class="form-check">
                  {{ form.remember_me }}
                  <label class="form-check-label small" for="{{ form.remember_me.id_for_label }}">
                    {{ form.remember_me.label }}
                  </label>
                </div>
              </div>
              <div class="col-5 text-end">
                <a href="{% url 'users:password_reset' %}" class="text-decoration-none text-success small">
                  Forgot Password?
                </a>
              </div>
            </div>

            <!-- Non-field errors -->
            {% if form.non_field_errors %}
            <div class="alert alert-danger mb-4">
              {% for error in form.non_field_errors %}
              <small>{{ error }}</small>
              {% endfor %}
            </div>
            {% endif %}

            <!-- Login Button -->
            <div class="d-grid mb-5">
              <button type="submit" class="btn btn-success py-3">
                <i class="fas fa-sign-in-alt me-2"></i>Sign In
              </button>
            </div>

            <!-- Register Link -->
            <div class="text-center">
              <p class="mb-0 small text-muted">New to JigsimurHerbal?
                <a href="{% url 'users:register' %}" class="text-success text-decoration-none fw-medium">
                  Create an account
                </a>
              </p>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function togglePassword() {
    const passwordField = document.getElementById('{{ form.password.id_for_label }}');
    const toggleIcon = document.getElementById('togglePasswordIcon');

    if (passwordField.type === 'password') {
      passwordField.type = 'text';
      toggleIcon.classList.remove('fa-eye');
      toggleIcon.classList.add('fa-eye-slash');
    } else {
      passwordField.type = 'password';
      toggleIcon.classList.remove('fa-eye-slash');
      toggleIcon.classList.add('fa-eye');
    }
  }

  // Form validation feedback
  document.addEventListener('DOMContentLoaded', function () {
    const form = document.querySelector('form');
    const inputs = form.querySelectorAll('input[required], input[type="password"]');

    inputs.forEach(input => {
      input.addEventListener('blur', function () {
        validateField(this);
      });

      input.addEventListener('input', function () {
        if (this.classList.contains('is-invalid')) {
          validateField(this);
        }
      });
    });

    function validateField(field) {
      const isValid = field.checkValidity();
      field.classList.toggle('is-valid', isValid && field.value.trim() !== '');
      field.classList.toggle('is-invalid', !isValid && field.value.trim() !== '');
    }
  });
</script>
{% endblock %}
